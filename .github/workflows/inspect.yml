name: Inspect Contexts

on: [push]

env:
  ACTION_URL: "https://github.com/${{ toJson(github.repository) }}/commit/${{ toJson(github.sha) }}/checks"
jobs:
  build:
    name: Inspect contexts
    runs-on: ubuntu-latest
    steps:
      - name: Inspect contexts
        run: |
          echo "The github context is:"
          echo "${{ toJson(github) }}"
          echo ""
          echo "The job context is:"
          echo "${{ toJson(job) }}"
          echo ""
          echo "The steps context is:"
          echo "${{ toJson(steps) }}"
          echo ""
          echo "The runner context is:"
          echo "${{ toJson(runner) }}"
          echo ""
          echo "The strategy context is:"
          echo "${{ toJson(strategy) }}"
          echo ""
          echo "The matrix context is:"
          echo "${{ toJson(matrix) }}"
          echo "URL TO ACTION"
          echo "We have this ${{ env.ACTION_URL }} and below"
          export URL="https://github.com/iamtito/react-app/commit/$(echo ${{ toJson(github.sha) }})/checks"
          echo "::set-env name=URL::${URL}"
          export event=$(echo ${{ toJson(github.event_name) }})
          echo $URL
          curl -X POST -H 'Content-type: application/json' --data '{"blocks": [{"type": "section","text": {"type": "mrkdwn","text": "Slack payload test"}},{"type": "section","fields": [{"type": "mrkdwn","text": "*Event* \n ${event}"},{"type": "mrkdwn","text": "*Action URL* \n < ${{ env.URL }} |link>"}]}]}'  ${{ secrets.BVITY_SLACK_WEBHOOK }}
          
          curl -s -d "payload={ \"username\":\"RPPrefresh Job\", \"attachments\":[{\"color\":\"#E01E5A\" , \"text\": \"Test $(echo ${{ toJson(github.event_name) }}) Ignore <${URL}|linking>\"}]}" ${{ secrets.BVITY_SLACK_WEBHOOK }}
